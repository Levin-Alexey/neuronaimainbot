/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–∑–¥–µ–ª–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
 */
import { sendMessage } from '../services/telegram.js';
import { handleManagerFlow } from './manager.js';
import { STATES } from '../utils/states.js';

const ABOUT_MESSAGE = `<b>üß† –û Neuron_AI</b>

<b>–ú—ã - –∫–æ–º–∞–Ω–¥–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –í–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞</b>

<b>–ù–∞—à–∞ –º–∏—Å—Å–∏—è:</b>
–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥–æ–≤—ã–µ AI-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –ª—é–±–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞ - –æ—Ç —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤ –¥–æ –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.

<b>üìä –ù–∞—à –æ–ø—ã—Ç:</b>
- 12+ –ª–µ—Ç –≤ IT –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- 50+ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö AI-–ø—Ä–æ–µ–∫—Ç–æ–≤
- –†–∞–±–æ—Ç–∞–ª–∏ —Å –ë–∏–ª–∞–π–Ω, –°–±–µ—Ä, –ë–†–ò–ö–°, Soft Line


<b>üéØ –ù–∞—à–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞:</b>
‚úì –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç-–±–æ—Ç–æ–≤ –∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
‚úì –°–æ–∑–¥–∞–Ω–∏–µ 3D-–∞–≤–∞—Ç–∞—Ä–æ–≤ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º
‚úì –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –±–∞–∑–µ AI
‚úì –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π
‚úì –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AI –≤ CRM, ERP –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
‚úì –û–±—É—á–µ–Ω–∏–µ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–µ–π –≤ –∑–∞–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç—É—Ä

<b>üí° –ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å:</b>
üîπ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç –∏–¥–µ–∏ –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
üîπ –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã —Å –∏–∑–º–µ—Ä–∏–º—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
üîπ –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 70% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
üîπ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
üîπ –†–∞–±–æ—Ç–∞–µ–º —Å –ª—é–±—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏: OpenAI, YandexGPT, open-source –º–æ–¥–µ–ª–∏

<b>üöÄ –ù–∞—à –ø–æ–¥—Ö–æ–¥:</b>
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à—É –∑–∞–¥–∞—á—É –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã
2. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å —Ä–∞—Å—á—ë—Ç–æ–º ROI
3. –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ç–æ—Ç–∏–ø
4. –í–Ω–µ–¥—Ä—è–µ–º –∏ –æ–±—É—á–∞–µ–º –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É
5. –°–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ä–µ—à–µ–Ω–∏–µ

<b>Neuron_AI - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏–∑–º–µ—Ä–∏—Ç—å</b>

‚ù§Ô∏è –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ—á–∏—Ç–∞—Ç—å –æ—Ç–∑—ã–≤—ã –æ –Ω–∞—à–µ–π —Ä–∞–±–æ—Ç–µ - –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
üìû –ï—Å–ª–∏ –≥–æ—Ç–æ–≤—ã –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç - –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º".`;

const ABOUT_KEYBOARD = {
  inline_keyboard: [
    [
      { text: '‚ù§Ô∏è –û—Ç–∑—ã–≤—ã –æ –Ω–∞—à–µ–π —Ä–∞–±–æ—Ç–µ', url: 'https://www.fl.ru/users/levin-am2/portfolio/' }
    ],
    [
      { text: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º', callback_data: 'contact_manager' }
    ],
    [
      { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back' }
    ]
  ]
};

const CONTACT_MANAGER_MESSAGE = `–î–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è - –∂–¥–µ–º –í–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è - https://t.me/LevinMSK`;

export async function handleAboutFlow(chatId, action, env, user = null) {
  if (action === 'about') {
    return sendMessage(chatId, ABOUT_MESSAGE, env, ABOUT_KEYBOARD);
  }
  
  if (action === 'contact_manager') {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
    if (!env.NEURON_KV) {
      return sendMessage(chatId, CONTACT_MANAGER_MESSAGE, env, {
        inline_keyboard: [[{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –æ–ø–∏—Å–∞–Ω–∏—é', callback_data: 'about' }]]
      });
    }
    
    await env.NEURON_KV.put(`user_state:${chatId}`, JSON.stringify({ step: STATES.IDLE, data: {} }));
    return handleManagerFlow(chatId, { message: { text: '', from: user } }, { step: STATES.IDLE }, env);
  }
}
